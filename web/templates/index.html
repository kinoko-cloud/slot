<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="googlebot" content="noindex, nofollow">
    <title>æœ¬æ—¥ã®ãŠã™ã™ã‚å°</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>æœ¬æ—¥ã®ãŠã™ã™ã‚å°</h1>
            <div class="today-info">{{ today_date }}({{ today_weekday }})</div>
        </header>

        <main>
            <!-- æœ¬æ—¥ãŠã™ã™ã‚åº—èˆ— -->
            {% if today_recommended_stores %}
            <section class="today-stores">
                <h2>{{ today_weekday }}æ›œæ—¥ã®ãŠã™ã™ã‚åº—èˆ—</h2>
                {% for store in today_recommended_stores %}
                <div class="store-recommend-card">
                    <span class="store-name">{{ store.name }}</span>
                    <span class="store-note">{{ store.note }}</span>
                </div>
                {% endfor %}
            </section>
            {% endif %}

            <!-- ã„ã¾ç‹™ã„ç›® TOP5 -->
            {% if top3 %}
            <section class="recommendations top">
                <h2>ã„ã¾ç‹™ã„ç›® TOP5</h2>
                {% for rec in top3 %}
                <a href="{{ url_for('recommend', store_key=rec.store_key) }}" class="unit-card rank-{{ rec.final_rank|lower }}" style="text-decoration: none;">
                    <div class="unit-header">
                        <span class="ranking-num">#{{ loop.index }}</span>
                        <span class="unit-id">{{ rec.unit_id }}ç•ªå°</span>
                        {% if rec.availability == 'ç©ºã' %}
                        <span class="top3-avail empty">ç©ºã</span>
                        {% elif rec.availability == 'éŠæŠ€ä¸­' %}
                        <span class="top3-avail playing">ç¨¼åƒä¸­</span>
                        {% endif %}
                        <span class="rank-badge" style="background-color: {{ rank_color(rec.final_rank) }}">
                            {{ rec.final_rank }}
                        </span>
                    </div>
                    <div class="unit-store">
                        <span class="machine-icon">{{ rec.machine_icon }}</span>
                        {{ rec.store_name }} / {{ rec.machine_name }}
                    </div>
                    <!-- æœ¬æ—¥ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒª -->
                    {% if rec.total_games > 0 %}
                    <div class="top3-stats">
                        <span><span class="num">{{ '{:,}'.format(rec.total_games) }}</span><span class="label">G</span></span>
                        <span><span class="num">{{ rec.art_count }}</span><span class="label">ART</span></span>
                        {% if rec.art_prob > 0 %}
                        <span class="{% if rec.art_prob <= 100 %}excellent{% elif rec.art_prob <= 130 %}good{% elif rec.art_prob >= 200 %}bad{% endif %}">1/{{ rec.art_prob|int }}</span>
                        {% endif %}
                        {% if rec.closing_estimate %}
                        <span class="profit {% if rec.closing_estimate >= 3000 %}high{% elif rec.closing_estimate >= 1000 %}mid{% else %}low{% endif %}">é–‰åº—è¦‹è¾¼{% if rec.closing_estimate >= 0 %}+{% endif %}{{ '{:,}'.format(rec.closing_estimate) }}æš</span>
                        {% endif %}
                    </div>
                    {% else %}
                    <!-- æœ¬æ—¥ãƒ‡ãƒ¼ã‚¿ãªã—ã§ã‚‚éå»ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º -->
                    <div class="top3-stats">
                        <span class="past-data">7æ—¥å¹³å‡<span class="num">{{ rec.avg_art_7days|round(0)|int }}</span>ART</span>
                        {% if rec.yesterday_diff != 0 %}
                        <span class="{% if rec.yesterday_diff > 0 %}good{% else %}bad{% endif %}">æ˜¨æ—¥{{ signed_number(rec.yesterday_diff) }}æš</span>
                        {% endif %}
                    </div>
                    {% endif %}
                    {% if rec.reasons %}
                    <div class="reasons-preview">
                        <span class="reason-icon">ğŸ’¡</span>
                        <span class="reason-text">{{ rec.reasons[0][:40] }}{% if rec.reasons[0]|length > 40 %}...{% endif %}</span>
                    </div>
                    {% endif %}
                </a>
                {% endfor %}
            </section>
            {% endif %}

            <!-- å‰æ—¥ãƒˆãƒƒãƒ—10 -->
            {% if yesterday_top10 %}
            <section class="yesterday-section">
                <h2>å‰æ—¥ã®å¥½èª¿å° TOP10</h2>
                <div class="yesterday-note">æ˜¨æ—¥ãƒ—ãƒ©ã‚¹ã ã£ãŸå°ï¼ˆæ®ãˆç½®ãç‹™ã„ï¼‰</div>
                {% for rec in yesterday_top10 %}
                <a href="{{ url_for('recommend', store_key=rec.store_key) }}" class="yesterday-card">
                    <div class="yesterday-header">
                        <span class="ranking-num-sm">#{{ loop.index }}</span>
                        <span class="machine-icon-sm">{{ rec.machine_icon }}</span>
                        <span class="unit-id-sm">{{ rec.unit_id }}</span>
                        <span class="store-name-sm">{{ rec.store_name }}</span>
                        {% if rec.availability == 'ç©ºã' %}
                        <span class="avail-sm empty">ç©º</span>
                        {% elif rec.availability == 'éŠæŠ€ä¸­' %}
                        <span class="avail-sm playing">ç¨¼</span>
                        {% endif %}
                    </div>
                    <div class="yesterday-stats">
                        <span class="yesterday-diff plus">æ˜¨æ—¥<span class="num">{{ signed_number(rec.yesterday_diff) }}</span>æš</span>
                        {% if rec.yesterday_art > 0 %}
                        <span class="avg-art">ART{{ rec.yesterday_art }}å›</span>
                        {% endif %}
                        <span class="machine-name-sm">{{ rec.machine_name }}</span>
                    </div>
                </a>
                {% endfor %}
            </section>
            {% endif %}

            <!-- åº—èˆ—åˆ¥ãŠã™ã™ã‚æ›œæ—¥ -->
            <section class="store-schedule">
                <h2>åº—èˆ—åˆ¥ãŠã™ã™ã‚æ›œæ—¥</h2>
                {% for store_key, info in store_recommendations.items() %}
                <a href="{{ url_for('recommend', store_key=store_key) }}" class="schedule-card" style="text-decoration: none;">
                    <span class="schedule-store">{{ info.short_name }}</span>
                    <span class="star-rating">
                        {% for i in range(5) %}{% if i < info.rating %}â˜…{% else %}<span class="empty">â˜†</span>{% endif %}{% endfor %}
                    </span>
                    <span class="schedule-days">
                        {% for day in info.best_days %}
                        <span class="day-badge {% if day == today_weekday %}today{% endif %}">{{ day }}</span>
                        {% endfor %}
                    </span>
                    <span class="schedule-note">{{ info.note }}</span>
                </a>
                {% endfor %}
            </section>

            <!-- æ©Ÿç¨®ã‹ã‚‰æ¢ã™ -->
            <section class="machine-list">
                <h2>æ©Ÿç¨®ã‹ã‚‰æ¢ã™</h2>
                {% for machine in machines %}
                <a href="{{ url_for('machine_stores', machine_key=machine.key) }}" class="machine-card">
                    <span class="machine-icon">{{ machine.icon }}</span>
                    <div class="machine-info">
                        <span class="machine-name">{{ machine.short_name }}</span>
                        <span class="machine-detail">{{ machine.store_count }}åº—èˆ— / {{ machine.unit_count }}å°</span>
                    </div>
                    <span class="arrow">â€º</span>
                </a>
                {% endfor %}
            </section>
        </main>

        <footer>
            <p class="hidden-text">.</p>
        </footer>
    </div>
</body>
</html>
