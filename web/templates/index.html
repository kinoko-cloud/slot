<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="googlebot" content="noindex, nofollow">
    <title>æœ¬æ—¥ã®ãŠã™ã™ã‚å°</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body data-page-type="index">
    <div class="container">
        <div class="version-info">{{ now_short }} Ver.</div>
        <header>
            {% if display_mode == 'result' %}
            <h1><span class="title-main">æœ¬æ—¥ã®çµæœ</span></h1>
            <div class="title-date">{{ result_date_str }}</div>
            <div class="mode-badge result">é–‰åº—å¾Œ</div>
            {% elif display_mode == 'collecting' %}
            <h1><span class="title-main">æœ¬æ—¥ã®çµæœ</span></h1>
            <div class="title-date">{{ result_date_str }}</div>
            <div class="mode-badge collecting">é›†è¨ˆä¸­...</div>
            {% else %}
            <h1><span class="title-main">æœ¬æ—¥ã®ãŠã™ã™ã‚å°</span></h1>
            <div class="title-date">{{ today_date_formatted }}</div>
            <div class="mode-badge realtime">å–¶æ¥­ä¸­</div>
            {% endif %}
            <div class="realtime-bar">
                <span id="realtime-status" class="realtime-status">èª­è¾¼ä¸­...</span>
                <button onclick="refreshData()" class="refresh-btn">ğŸ”„ æ›´æ–°</button>
            </div>
        </header>

        <main>
            <!-- ç‹™ã„ç›® / çµæœ TOP3 -->
            {% if top3 %}
            <section class="recommendations top" id="top3-section">
                {% if display_mode == 'result' %}
                <h2>{{ result_date_str }}ã®å¥½èª¿å°</h2>
                <div class="top5-note">â€»å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ï¼ˆARTå›æ•°ãƒ»å‡ºç‰ï¼‰ã§è©•ä¾¡</div>
                {% elif display_mode == 'collecting' %}
                <h2>{{ result_date_str }}ã®é€Ÿå ±</h2>
                <div class="top5-note">â€»ãƒ‡ãƒ¼ã‚¿é›†è¨ˆä¸­...</div>
                {% else %}
                <h2>ã„ã¾ç‹™ã„ç›®ã®å°</h2>
                <div class="top5-note">â€»æ©Ÿç¨® / åº—å / å°ç•ªå·</div>
                {% endif %}
                {% for rec in top3 %}
                <a href="{{ url_for('recommend', store_key=rec.store_key) }}" class="unit-card rank-{{ rec.final_rank|lower }}" style="text-decoration: none; color: inherit;">
                    <div class="unit-header">
                        <span class="ranking-num">#{{ loop.index }}</span>
                        <span class="machine-icon">{{ rec.machine_icon }}</span>
                        <span class="machine-name-top">{{ rec.machine_name }}</span>
                        <span class="rank-badge" style="background-color: {{ rank_color(rec.final_rank) }}">{{ rec.final_rank }}</span>
                    </div>
                    <div class="unit-store">
                        <span class="store-link">{{ rec.store_name }}</span> / <span class="unit-id-sub">{{ rec.unit_id }}ç•ª</span>
                        {% if is_open %}
                            {% if rec.availability == 'ç©ºã' %}
                            <span class="top3-avail empty">ç©ºã</span>
                            {% elif rec.availability == 'éŠæŠ€ä¸­' %}
                            <span class="top3-avail playing">ç¨¼åƒä¸­</span>
                            {% endif %}
                        {% else %}
                            <span class="top3-avail closed">å–¶æ¥­å¤–</span>
                        {% endif %}
                    </div>
                    <div class="top3-stats-main">
                        {% if rec.art_count > 0 %}
                        <span class="art-main"><span class="art-num-big">{{ rec.art_count }}</span><span class="art-label">ART</span></span>
                        {% if rec.art_prob > 0 %}<span class="art-prob {% if rec.art_prob <= 100 %}excellent{% elif rec.art_prob <= 130 %}good{% elif rec.art_prob >= 200 %}bad{% endif %}" title="åˆæˆç¢ºç‡">1/{{ rec.art_prob|int }}</span>{% endif %}
                        {% else %}
                        <span class="art-main past"><span class="art-num-big">{{ rec.avg_art_7days|round(0)|int }}</span><span class="art-label">ART(7æ—¥å¹³å‡)</span></span>
                        {% endif %}
                    </div>
                    <div class="top3-stats-sub">
                        {% if rec.closing_estimate and rec.closing_estimate > 0 %}<span class="current-hama">ATé–“<span class="num">{{ rec.closing_estimate }}</span>G</span>{% endif %}
                        {% if rec.total_games > 0 %}<span class="total-games">ç´¯è¨ˆ<span class="num">{{ '{:,}'.format(rec.total_games) }}</span>G</span>{% endif %}
                        {% if rec.max_medals and rec.max_medals > 0 %}{% set badge = medals_badge(rec.max_medals) %}<span class="max-medals-top {% if badge %}{{ badge.class }}{% endif %}">{% if badge %}<span class="medals-icon">{{ badge.icon }}</span>{% endif %}æœ€å¤§<span class="num">{{ '{:,}'.format(rec.max_medals) }}</span>æš</span>{% endif %}
                    </div>
                    {% if rec.reasons %}
                    <div class="reasons-preview">
                        <span class="reason-icon">ğŸ’¡</span>
                        <span class="reason-text">{{ rec.reasons[0][:40] }}{% if rec.reasons[0]|length > 40 %}...{% endif %}</span>
                    </div>
                    {% endif %}
                </a>
                {% endfor %}
            </section>
            {% endif %}

            <!-- æ©Ÿç¨®ã‹ã‚‰æ¢ã™ -->
            <section class="machine-list">
                <h2>æ©Ÿç¨®ã‹ã‚‰æ¢ã™</h2>
                {% for machine in machines %}
                <a href="{{ url_for('machine_stores', machine_key=machine.key) }}" class="machine-card">
                    <span class="machine-icon">{{ machine.icon }}</span>
                    <div class="machine-info">
                        <span class="machine-name">{{ machine.short_name }}</span>
                        <span class="machine-detail">{{ machine.store_count }}åº—èˆ— / {{ machine.unit_count }}å°</span>
                    </div>
                    <span class="arrow">â€º</span>
                </a>
                {% endfor %}
            </section>

            <!-- åº—èˆ—åˆ¥æ›œæ—¥å‚¾å‘ï¼ˆéå»ãƒ‡ãƒ¼ã‚¿åˆ†æï¼‰ -->
            <section class="store-schedule">
                <h2>éå»ãƒ‡ãƒ¼ã‚¿åˆ†æ: åº—èˆ—åˆ¥ã®æ›œæ—¥å‚¾å‘</h2>
                <div class="schedule-legend">
                    <span class="legend-item best">â˜…5=æœ€å¼·</span>
                    <span class="legend-item good">â˜…4=ç‹™ã„ç›®</span>
                    <span class="legend-item normal">â˜…3=æ™®é€š</span>
                    <span class="legend-item weak">â˜…2ä»¥ä¸‹=é¿ã‘ã‚‹</span>
                </div>
                {% for store in today_store_ranking %}
                <a href="{{ url_for('recommend', store_key=store.store_key) }}" class="schedule-card-full" style="text-decoration: none;">
                    <div class="schedule-store-name">{{ store.short_name }}</div>
                    <div class="schedule-week">
                        {% for day in ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'] %}
                        {% set rating = store.day_ratings[day] %}
                        <span class="day-cell {% if rating >= 5 %}best{% elif rating >= 4 %}good{% elif rating <= 2 %}weak{% else %}normal{% endif %} {% if day == today_weekday %}today{% endif %}">
                            <span class="day-name">{{ day }}</span>
                            <span class="day-stars">{{ 'â˜…' * rating }}</span>
                        </span>
                        {% endfor %}
                    </div>
                    <div class="schedule-notes">
                        <span class="note-best">{{ store.best_note }}</span>
                    </div>
                </a>
                {% endfor %}
            </section>

            <!-- å‰æ—¥ãƒˆãƒƒãƒ—10 (æœ€å¾Œã«é…ç½®) -->
            {% if yesterday_top10 %}
            <section class="yesterday-section">
                <h2>å‰æ—¥ã®çˆ†ç™ºå° TOP10</h2>
                <div class="yesterday-note">æœ€å¤§æšæ•°ãŒå¤šã‹ã£ãŸå°ï¼ˆæ®ãˆç½®ãç‹™ã„å‚è€ƒï¼‰</div>
                {% for rec in yesterday_top10 %}
                <a href="{{ url_for('recommend', store_key=rec.store_key) }}" class="yesterday-card">
                    <div class="yesterday-header">
                        <span class="ranking-num-sm">#{{ loop.index }}</span>
                        <span class="machine-icon-sm">{{ rec.machine_icon }}</span>
                        <span class="store-name-sm">{{ rec.store_name }}</span>
                        <span class="unit-id-sm">{{ rec.unit_id }}ç•ª</span>
                        {% if is_open %}
                            {% if rec.availability == 'ç©ºã' %}
                            <span class="avail-sm empty">ç©º</span>
                            {% elif rec.availability == 'éŠæŠ€ä¸­' %}
                            <span class="avail-sm playing">ç¨¼</span>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="yesterday-stats">
                        {% if rec.max_medals > 0 %}
                        <span class="max-medals">æœ€å¤§<span class="num">{{ '{:,}'.format(rec.max_medals) }}</span>æš</span>
                        {% endif %}
                        {% if rec.yesterday_art > 0 %}
                        <span class="art-badge">ART <span class="art-num">{{ rec.yesterday_art }}</span></span>
                        {% endif %}
                    </div>
                </a>
                {% endfor %}
            </section>
            {% endif %}
        </main>

        <!-- æœ¬æ—¥ã®å‚¾å‘ï¼ˆæ›œæ—¥åˆ¥è©•ä¾¡ã‚’ç°¡æ½”ã«ï¼‰ -->
        <section class="today-trend">
            <h2>{{ today_weekday }}æ›œæ—¥ã®å‚¾å‘</h2>
            {% if today_recommended_stores %}
            <div class="trend-item good">
                <span class="trend-label">ç‹™ã„ç›®åº—èˆ—:</span>
                {% for store in today_recommended_stores %}
                <a href="{{ url_for('recommend', store_key=store.store_key) }}" class="trend-store">{{ store.short_name }}</a>{% if not loop.last %}ã€{% endif %}
                {% endfor %}
            </div>
            {% endif %}
            {% if today_avoid_stores %}
            <div class="trend-item bad">
                <span class="trend-label">é¿ã‘ã‚‹ã¹ã:</span>
                {% for store in today_avoid_stores %}
                <a href="{{ url_for('recommend', store_key=store.store_key) }}" class="trend-store">{{ store.short_name }}</a>{% if not loop.last %}ã€{% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </section>

        <footer>
        </footer>
    </div>
    <script src="{{ url_for('static', filename='realtime.js') }}"></script>
</body>
</html>
