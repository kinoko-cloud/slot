<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ãƒãƒ«ãƒã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 2000px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .notes {
            background: #f8f9fa;
            border-left: 4px solid #0066cc;
            padding: 25px;
            margin-top: 30px;
            border-radius: 4px;
        }
        .notes h3 {
            margin-top: 0;
            color: #0066cc;
            font-size: 1.4em;
        }
        .notes h4 {
            color: #0066cc;
            font-size: 1.2em;
            margin-top: 20px;
        }
        .notes h5 {
            color: #555;
            font-size: 1.1em;
            margin-top: 15px;
        }
        .notes ul, .notes ol {
            margin: 10px 0;
            line-height: 1.8;
        }
        .notes li {
            margin-bottom: 8px;
        }
        .future-plans {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        .future-plans h3 {
            color: #ff9800;
        }
        .services-list {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        .services-list h3 {
            color: #2e7d32;
        }
        .mermaid {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .mermaid svg {
            max-width: none !important;
            min-width: 1800px !important;
            height: auto !important;
        }
        @media print {
            body { background: white; }
            .container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ï¸ ãƒãƒ«ãƒã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³</h1>

        <div class="notes services-list">
            <h3>ğŸ“‹ ä½¿ç”¨ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§ï¼ˆå®Œå…¨ç‰ˆï¼‰</h3>

            <h4>ğŸ”§ é–‹ç™ºãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†</h4>
            <ul>
                <li><strong>Windows Subsystem for Linux (WSL)</strong> - ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ</li>
                <li><strong>GitHub Account A (Primary)</strong> - ãƒ¡ã‚¤ãƒ³ãƒªãƒã‚¸ãƒˆãƒªã€é™çš„ã‚µã‚¤ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤</li>
                <li><strong>GitHub Account B (Secondary)</strong> - ãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒã‚¸ãƒˆãƒªã€CI/CDç„¡æ–™æ åˆ†æ•£</li>
            </ul>

            <h4>âš™ï¸ CI/CDãƒ»è‡ªå‹•åŒ–</h4>
            <ul>
                <li><strong>GitHub Actions (Account A)</strong>:
                    <ul>
                        <li>deploy-static.yml - é™çš„ã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ‰ï¼ˆ1æ—¥4å›ï¼‰</li>
                        <li>deploy.yml - PythonAnywhereã¸è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤</li>
                        <li>daily-verify.yml - æ—¥æ¬¡äºˆæ¸¬æ¤œè¨¼ï¼ˆ23:30 JSTï¼‰</li>
                    </ul>
                </li>
                <li><strong>GitHub Actions (Account B)</strong>:
                    <ul>
                        <li>fetch-availability.yml - æ¯æ™‚ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ10-23æ™‚ JSTï¼‰</li>
                        <li>daily_collect.yml - æ—¥æ¬¡ãƒ•ãƒ«ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆ14:00 UTCï¼‰</li>
                    </ul>
                </li>
                <li><strong>Circle CI (Account B)</strong> - é‡ã„å‡¦ç†å°‚ç”¨ï¼ˆPlaywrightè‡ªå‹•åŒ–ï¼‰</li>
                <li><strong>Local Cron (WSL)</strong> - 15åˆ†é–“éš”ã®è‡ªå‹•æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆauto_update.shï¼‰</li>
            </ul>

            <h4>ğŸŒ ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ»API</h4>
            <ul>
                <li><strong>Cloudflare Pages</strong> - é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«CDNï¼‰</li>
                <li><strong>PythonAnywhere</strong> - Flask APIã‚µãƒ¼ãƒãƒ¼ï¼ˆ24/7ç¨¼åƒã€v14ï¼‰+ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬ã‚¨ãƒ³ã‚¸ãƒ³</li>
                <li><strong>Google Apps Script (GAS)</strong> - è»½é‡ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</li>
            </ul>

            <h4>ğŸ§  äºˆæ¸¬ãƒ»åˆ†æã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼‰</h4>
            <ul>
                <li><strong>analysis/recommender.py</strong> - ãƒ¡ã‚¤ãƒ³äºˆæ¸¬ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°/ãƒ©ãƒ³ã‚¯ä»˜ã‘ï¼‰</li>
                <li><strong>analysis/history_accumulator.py</strong> - è“„ç©DBç®¡ç†ï¼ˆé€£ãƒãƒ£ãƒ³ãƒ»å·®æšè¨ˆç®—ï¼‰</li>
                <li><strong>analysis/pattern_detector.py</strong> - ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º</li>
                <li><strong>config/rankings.py</strong> - æ©Ÿç¨®åˆ¥é–¾å€¤å®šç¾©ï¼ˆäºˆæ¸¬ãƒ«ãƒ¼ãƒ«ï¼‰</li>
            </ul>

            <h4>ğŸ“‚ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</h4>
            <ul>
                <li><strong>data/history/{store}/{unit}.json</strong> - è“„ç©DBï¼ˆå°ã”ã¨ã®å…¨æ—¥å±¥æ­´ã€æœ€é‡è¦ï¼‰</li>
                <li><strong>data/daily/{store}/YYYY-MM-DD.json</strong> - æ—¥åˆ¥ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ</li>
                <li><strong>data/availability/{store}.json</strong> - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç©ºãçŠ¶æ³</li>
            </ul>

            <h4>ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ãƒ»ç›£è¦–</h4>
            <ul>
                <li><strong>scripts/validate_output.py</strong> - ãƒ“ãƒ«ãƒ‰å¾ŒHTMLæ¤œè¨¼ + ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯</li>
                <li><strong>scripts/data_integrity_check.py</strong> - ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯</li>
                <li><strong>scripts/nightly_verify.py</strong> - å¤œé–“çš„ä¸­æ¤œè¨¼ï¼ˆäºˆæ¸¬ç²¾åº¦æ¸¬å®šï¼‰</li>
                <li><strong>scripts/verify_units.py</strong> - å°å¤‰å‹•ãƒã‚§ãƒƒã‚¯ï¼ˆæ¸›å°ãƒ»å¢—å°ãƒ»å°ç•ªå·å¤‰æ›´æ¤œå‡ºï¼‰</li>
                <li><strong>INTEGRATION_CHECK.md</strong> - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã®æ‰‹å‹•ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</li>
            </ul>

            <h4>â˜ï¸ å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº</h4>
            <ul>
                <li><strong>WhatsApp</strong> - é€šçŸ¥ãƒ»ãƒ¢ãƒã‚¤ãƒ«åˆ¶å¾¡ï¼ˆclawdbotçµŒç”±ï¼‰</li>
                <li><strong>Anthropic API (Claude)</strong> - LLMçµ±åˆï¼ˆBotç”¨ï¼‰</li>
            </ul>

            <h4>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹</h4>
            <ul>
                <li><strong>Data Provider A</strong> - Webã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¯¾è±¡ï¼ˆåŒ¿ååŒ–ï¼‰</li>
                <li><strong>Data Provider B</strong> - Webã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¯¾è±¡ï¼ˆåŒ¿ååŒ–ï¼‰</li>
                <li><strong>Data Provider C</strong> - å°†æ¥ã®APIçµ±åˆäºˆå®š</li>
            </ul>

            <h4>ğŸ”‘ èªè¨¼</h4>
            <ul>
                <li><strong>SSH Key (Primary)</strong> - ~/.ssh/key_primary â†’ Account Aç”¨èªè¨¼</li>
                <li><strong>SSH Key (Secondary)</strong> - ~/.ssh/key_secondary â†’ Account Bç”¨èªè¨¼</li>
                <li><strong>~/.ssh/config</strong> - ãƒ›ã‚¹ãƒˆç®¡ç†è¨­å®š</li>
            </ul>
        </div>

        <div class="mermaid">
graph TB
    %% Style definitions
    classDef localStyle fill:#E8F5E9,stroke:#4CAF50,stroke-width:4px,font-size:16px
    classDef githubStyle fill:#E3F2FD,stroke:#2196F3,stroke-width:4px,font-size:16px
    classDef ciStyle fill:#FFF3E0,stroke:#FF9800,stroke-width:4px,font-size:16px
    classDef externalStyle fill:#F3E5F5,stroke:#9C27B0,stroke-width:4px,font-size:16px
    classDef hostingStyle fill:#E1F5FE,stroke:#01579B,stroke-width:4px,font-size:16px
    classDef dataStyle fill:#FCE4EC,stroke:#E91E63,stroke-width:4px,font-size:16px
    classDef userStyle fill:#FFFDE7,stroke:#FDD835,stroke-width:4px,font-size:16px
    classDef sshStyle fill:#E0F2F1,stroke:#009688,stroke-width:4px,font-size:16px
    classDef futureStyle fill:#FFE0B2,stroke:#FF6F00,stroke-width:4px,stroke-dasharray: 5 5,font-size:16px
    classDef predictionStyle fill:#FFF9C4,stroke:#F57F17,stroke-width:5px,font-size:16px
    classDef storageStyle fill:#E8EAF6,stroke:#3F51B5,stroke-width:4px,font-size:16px
    classDef testingStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:4px,font-size:16px

    %% ========== Local Environment ==========
    subgraph LOCAL["ğŸ–¥ï¸ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ (WSL)"]
        PROJECT["ğŸ“ ~/project-c<br/>(ãƒ¡ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹)"]
        BOT["ğŸ¤– Bot Gateway<br/>(ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°çµ±åˆ)"]
        WORKSPACE["ğŸ“‚ ~/workspace/"]
        CRON["â° ãƒ­ãƒ¼ã‚«ãƒ«Cron<br/>(15åˆ†é–“éš”è‡ªå‹•æ›´æ–°)"]
    end

    %% ========== GitHub Accounts ==========
    subgraph GITHUB["ğŸ™ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† (GitHub)"]
        GH_MAIN["Account A (Primary)<br/>ğŸ“„ ãƒ¡ã‚¤ãƒ³ãƒªãƒã‚¸ãƒˆãƒª"]
        GH_SEC["Account B (Secondary)<br/>âš¡ ãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒã‚¸ãƒˆãƒª"]
    end

    %% ========== CI/CD Services ==========
    subgraph CICD["âš™ï¸ CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³"]
        subgraph GHA_MAIN_FLOWS["GitHub Actions (Account A)"]
            GHA_DEPLOY["deploy-static.yml<br/>ğŸš€ é™çš„ã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ‰<br/>(1æ—¥4å›)"]
            GHA_DEPLOY2["deploy.yml<br/>ğŸ“¤ PaaSãƒ‡ãƒ—ãƒ­ã‚¤<br/>(pushæ™‚)"]
            GHA_VERIFY["daily-verify.yml<br/>âœ… æ—¥æ¬¡æ¤œè¨¼<br/>(23:30 JST)"]
        end

        subgraph GHA_SEC_FLOWS["GitHub Actions (Account B)"]
            GHA_FETCH["fetch-availability.yml<br/>ğŸ” æ¯æ™‚ãƒ‡ãƒ¼ã‚¿å–å¾—<br/>(10-23æ™‚ JST)"]
            GHA_COLLECT["daily_collect.yml<br/>ğŸ“Š æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿åé›†<br/>(14:00 UTC)"]
        end

        CIRCLE["Circle CI (Account B)<br/>ğŸ­ é‡ã„å‡¦ç†å°‚ç”¨<br/>(Playwright)"]
        CIRCLE_FUTURE["Circle CI (å°†æ¥è¨ˆç”»)<br/>ğŸ“Š é«˜åº¦ãªåˆ†æ<br/>ğŸ”„ ãƒãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³"]
    end

    %% ========== SSH Configuration ==========
    subgraph SSH["ğŸ”‘ èªè¨¼ãƒ¬ã‚¤ãƒ¤ãƒ¼"]
        SSH1["~/.ssh/key_primary<br/>â†’ Account A"]
        SSH2["~/.ssh/key_secondary<br/>â†’ Account B"]
        SSHCONF["~/.ssh/config<br/>ãƒ›ã‚¹ãƒˆç®¡ç†"]
    end

    %% ========== Prediction Engine ==========
    subgraph PREDICTION["ğŸ§  äºˆæ¸¬ãƒ»åˆ†æã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆã‚³ã‚¢ï¼‰"]
        RECOMMENDER["analysis/recommender.py<br/>ğŸ“Š ãƒ¡ã‚¤ãƒ³äºˆæ¸¬ãƒ­ã‚¸ãƒƒã‚¯<br/>(ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°/ãƒ©ãƒ³ã‚¯)"]
        ACCUMULATOR["analysis/history_accumulator.py<br/>ğŸ“ˆ è“„ç©DBç®¡ç†<br/>(é€£ãƒãƒ£ãƒ³/å·®æš)"]
        DETECTOR["analysis/pattern_detector.py<br/>ğŸ” ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º"]
    end

    %% ========== Data Storage ==========
    subgraph STORAGE["ğŸ“‚ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸"]
        HISTORY_DB["data/history/<br/>ğŸ—„ï¸ è“„ç©DB<br/>(å…¨æ—¥å±¥æ­´)"]
        DAILY_DB["data/daily/<br/>ğŸ“… æ—¥åˆ¥ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ"]
        AVAIL_DB["data/availability/<br/>âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç©ºãçŠ¶æ³"]
    end

    %% ========== Testing & Validation ==========
    subgraph TESTING["ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ãƒ»ç›£è¦–"]
        VALIDATE["validate_output.py<br/>âœ… HTMLæ¤œè¨¼"]
        INTEGRITY["data_integrity_check.py<br/>ğŸ” å“è³ªãƒã‚§ãƒƒã‚¯"]
        VERIFY["nightly_verify.py<br/>ğŸ“Š çš„ä¸­æ¤œè¨¼"]
        VERIFY_UNITS["verify_units.py<br/>ğŸ”§ å°å¤‰å‹•ãƒã‚§ãƒƒã‚¯<br/>(æ¸›å°/å¢—å°/ç§»å‹•æ¤œå‡º)"]
    end

    %% ========== Hosting ==========
    subgraph HOSTING["ğŸŒ ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° & CDN"]
        CLOUDFLARE["Cloudflare Pages<br/>âš¡ é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°<br/>(ã‚°ãƒ­ãƒ¼ãƒãƒ«CDN)"]
    end

    %% ========== External Services ==========
    subgraph EXTERNAL["â˜ï¸ å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹"]
        PAAS["PaaS Platform<br/>ğŸŒ Flask API (24/7)<br/>(v14)<br/>+ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬"]
        GAS["Google Apps Script<br/>âš¡ è»½é‡API<br/>(ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°)"]
        MESSAGING["Messaging Service<br/>ğŸ’¬ é€šçŸ¥ãƒ»åˆ¶å¾¡<br/>(WhatsApp)"]
        AI_API["AI Service API<br/>ğŸ§  LLMçµ±åˆ<br/>(Anthropic Claude)"]
    end

    %% ========== Data Sources ==========
    subgraph DATA["ğŸ“Š å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹"]
        DS_A["Data Provider A<br/>(Webã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°)"]
        DS_B["Data Provider B<br/>(Webã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°)"]
        DS_C["Data Provider C<br/>(APIã‚¢ã‚¯ã‚»ã‚¹ - å°†æ¥)"]
    end

    %% ========== Users ==========
    subgraph USERS["ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹"]
        BROWSER["ğŸŒ Webãƒ–ãƒ©ã‚¦ã‚¶"]
        MOBILE["ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"]
    end

    %% ========== Data Flow ==========

    %% Local -> GitHub
    PROJECT -->|"git push (SSH)"| GH_MAIN
    PROJECT -->|"git push (SSH)"| GH_SEC

    %% SSH Keys
    SSH1 -.->|èªè¨¼| GH_MAIN
    SSH2 -.->|èªè¨¼| GH_SEC
    PROJECT -.->|è¨­å®š| SSHCONF

    %% Local Cron
    CRON -->|"15åˆ†è‡ªå‹•æ›´æ–°"| PROJECT

    %% GitHub -> CI/CD
    GH_MAIN -->|webhook| GHA_DEPLOY
    GH_MAIN -->|webhook| GHA_DEPLOY2
    GH_MAIN -->|webhook| GHA_VERIFY
    GH_SEC -->|webhook| GHA_FETCH
    GH_SEC -->|webhook| GHA_COLLECT
    GH_SEC -->|webhook| CIRCLE

    %% CI/CD -> Data Sources
    GHA_FETCH -->|"æ¯æ™‚ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—"| DS_A
    GHA_FETCH -->|"æ¯æ™‚ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—"| DS_B
    GHA_COLLECT -->|"æ—¥æ¬¡ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—"| DS_A
    GHA_COLLECT -->|"æ—¥æ¬¡ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—"| DS_B
    CIRCLE -->|"Playwright"| DS_A
    CIRCLE -->|"Playwright"| DS_B

    %% CI/CD -> Storage
    GHA_FETCH -->|ä¿å­˜| AVAIL_DB
    GHA_COLLECT -->|è“„ç©| HISTORY_DB
    GHA_COLLECT -->|ä¿å­˜| DAILY_DB

    %% Storage -> GitHub
    AVAIL_DB -->|commit| GH_MAIN
    HISTORY_DB -->|commit| GH_MAIN
    DAILY_DB -->|commit| GH_MAIN

    %% Testing
    GHA_DEPLOY -->|æ¤œè¨¼| VALIDATE
    GHA_COLLECT -->|å“è³ª| INTEGRITY
    GHA_VERIFY -->|å®Ÿè¡Œ| VERIFY
    GHA_FETCH -->|å°å¤‰å‹•| VERIFY_UNITS

    %% CI/CD -> Prediction -> Hosting
    GHA_DEPLOY -->|"é™çš„ãƒ“ãƒ«ãƒ‰"| RECOMMENDER
    RECOMMENDER -->|å‚ç…§| HISTORY_DB
    RECOMMENDER -->|"HTMLç”Ÿæˆ"| CLOUDFLARE

    %% CI/CD -> PaaS
    GHA_DEPLOY2 -->|"git pull + reload"| PAAS

    %% PaaS -> Storage
    PAAS -->|èª­è¾¼| AVAIL_DB
    PAAS -->|èª­è¾¼| HISTORY_DB

    %% PaaS -> Data Sources
    PAAS -->|"ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰"| DS_A
    PAAS -->|"ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰"| DS_B

    %% PaaS -> Prediction
    PAAS -->|"ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬"| RECOMMENDER
    RECOMMENDER -->|"äºˆæ¸¬JSON"| PAAS

    %% GAS -> Data Sources
    GAS -->|"ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—"| DS_A
    GAS -->|"ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—"| DS_B

    %% Local <-> External Services
    BOT <-->|WebSocket| MESSAGING
    BOT -->|API| AI_API

    %% Users -> Services
    BROWSER -->|HTTPS| CLOUDFLARE
    BROWSER -->|API| PAAS
    BROWSER -->|API| GAS
    MOBILE -->|é€å—ä¿¡| MESSAGING

    %% Workspace
    BOT -.->|ã‚¢ã‚¯ã‚»ã‚¹| WORKSPACE
    PROJECT -.->|symlink| WORKSPACE

    %% Future
    CIRCLE_FUTURE -.->|è¨ˆç”»ä¸­| DS_C
    CIRCLE_FUTURE -.->|è¨ˆç”»ä¸­| PAAS
    CIRCLE_FUTURE -.->|è¨ˆç”»ä¸­| CLOUDFLARE

    %% Style application
    class PROJECT,BOT,WORKSPACE,CRON localStyle
    class GH_MAIN,GH_SEC githubStyle
    class GHA_DEPLOY,GHA_DEPLOY2,GHA_VERIFY,GHA_FETCH,GHA_COLLECT,CIRCLE ciStyle
    class PAAS,GAS,MESSAGING,AI_API externalStyle
    class CLOUDFLARE hostingStyle
    class DS_A,DS_B,DS_C dataStyle
    class BROWSER,MOBILE userStyle
    class SSH1,SSH2,SSHCONF sshStyle
    class CIRCLE_FUTURE futureStyle
    class RECOMMENDER,ACCUMULATOR,DETECTOR predictionStyle
    class HISTORY_DB,DAILY_DB,AVAIL_DB storageStyle
    class VALIDATE,INTEGRITY,VERIFY,VERIFY_UNITS testingStyle
        </div>

        <div class="notes">
            <h3>ğŸ§  äºˆæ¸¬ãƒ­ã‚¸ãƒƒã‚¯ã®ä»•çµ„ã¿ï¼ˆå®Œå…¨ç‰ˆï¼‰</h3>

            <h4>2ã¤ã®äºˆæ¸¬ãƒ¢ãƒ¼ãƒ‰</h4>

            <h5>ğŸ“„ é™çš„ãƒ“ãƒ«ãƒ‰æ™‚ã®äºˆæ¸¬ï¼ˆé–‰åº—å¾Œ 23:00ã€œç¿Œ9:59ï¼‰</h5>
            <ol>
                <li>CI/CDï¼ˆdeploy-static.ymlï¼‰ãŒãƒˆãƒªã‚¬ãƒ¼</li>
                <li><strong>scripts/generate_static.py</strong> ãŒèµ·å‹•</li>
                <li><strong>analysis/recommender.py</strong> ã‚’å‘¼ã³å‡ºã—</li>
                <li>è“„ç©DBï¼ˆdata/history/ï¼‰ã‹ã‚‰å…¨æ—¥ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿</li>
                <li>æ©Ÿç¨®åˆ¥é–¾å€¤ï¼ˆconfig/rankings.pyï¼‰ã«åŸºã¥ã„ã¦ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°</li>
                <li>ãƒ©ãƒ³ã‚¯ä»˜ã‘ï¼ˆS/A/B/Cï¼‰ã¨ãŠã™ã™ã‚æ–‡ã‚’ç”Ÿæˆ</li>
                <li>é™çš„HTMLç”Ÿæˆ â†’ Cloudflare Pages ã¸ãƒ‡ãƒ—ãƒ­ã‚¤</li>
                <li>validate_output.pyã§æ¤œè¨¼</li>
            </ol>

            <h5>âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬ï¼ˆå–¶æ¥­ä¸­ 10:00ã€œ22:49ï¼‰</h5>
            <ol>
                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒšãƒ¼ã‚¸ã‚’é–‹ãï¼ˆCloudflare Pagesï¼‰</li>
                <li><strong>web/static/realtime.js</strong> ãŒPythonAnywhere APIã‚’å‘¼ã³å‡ºã—</li>
                <li><strong>PythonAnywhere (web/app.py)</strong> ãŒèµ·å‹•</li>
                <li>æœ€æ–°ã®data/availability/ã‚’èª­ã¿è¾¼ã¿</li>
                <li>è“„ç©DBï¼ˆdata/history/ï¼‰ã‹ã‚‰å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿</li>
                <li><strong>analysis/recommender.py</strong> ã‚’å‘¼ã³å‡ºã—ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬ï¼‰</li>
                <li>æœ€æ–°ãƒ‡ãƒ¼ã‚¿ï¼ˆå½“ãŸã‚Šå±¥æ­´ãƒ»å›è»¢æ•°ï¼‰ã§ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°</li>
                <li>äºˆæ¸¬çµæœã‚’JSONã§è¿”å´</li>
                <li>ãƒ–ãƒ©ã‚¦ã‚¶ãŒUIã‚’æ›´æ–°ï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ 10-30ç§’ â†’ äºˆæ¸¬çµæœè¡¨ç¤ºï¼‰</li>
            </ol>

            <h4>â° æ™‚é–“å¸¯åˆ¥ã®è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ</h4>
            <ul>
                <li><strong>å–¶æ¥­ä¸­ãƒ¢ãƒ¼ãƒ‰ï¼ˆ10:00ã€œ22:49ï¼‰</strong>:
                    <ul>
                        <li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬ãŒæœ‰åŠ¹</li>
                        <li>ãƒšãƒ¼ã‚¸ã‚’é–‹ããŸã³ã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§äºˆæ¸¬</li>
                        <li>ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢è¡¨ç¤ºï¼ˆ10-30ç§’ï¼‰</li>
                        <li>3-5åˆ†é–“éš”ã§è‡ªå‹•æ›´æ–°</li>
                    </ul>
                </li>
                <li><strong>é›†è¨ˆä¸­ãƒ¢ãƒ¼ãƒ‰ï¼ˆ22:50ã€œ22:59ï¼‰</strong>:
                    <ul>
                        <li>ã€Œé›†è¨ˆä¸­ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º</li>
                        <li>æœ€çµ‚ãƒ‡ãƒ¼ã‚¿åé›†ã¨ç¿Œæ—¥äºˆæ¸¬ã®æº–å‚™</li>
                    </ul>
                </li>
                <li><strong>çµæœãƒ¢ãƒ¼ãƒ‰ï¼ˆ23:00ã€œç¿Œ9:59ï¼‰</strong>:
                    <ul>
                        <li>é™çš„HTMLè¡¨ç¤ºï¼ˆCloudflare Pagesï¼‰</li>
                        <li>ç¢ºå®šãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç¿Œæ—¥ã®äºˆæ¸¬ã‚’è¡¨ç¤º</li>
                        <li>å‰æ—¥ã®çš„ä¸­çµæœã‚‚è¡¨ç¤º</li>
                    </ul>
                </li>
            </ul>
            <p><em>â€» ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã¯PythonAnywhere (web/app.py) ã®get_display_mode()ã§è‡ªå‹•åˆ¤å®š</em></p>

            <h4>ğŸ”§ å°å¤‰å‹•ãƒã‚§ãƒƒã‚¯ï¼ˆverify_units.pyï¼‰</h4>
            <p>å°ã®ç”Ÿå­˜ç¢ºèªãƒ»å¤‰å‹•æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ :</p>
            <ul>
                <li><strong>æ¤œå‡ºå†…å®¹</strong>:
                    <ul>
                        <li>å°ç•ªå·å¤‰æ›´ï¼ˆç§»è¨­ãƒ»é…ç½®å¤‰æ›´ï¼‰</li>
                        <li>æ¸›å°ï¼ˆæ’¤å»ï¼‰</li>
                        <li>å¢—å°ï¼ˆæ–°è¦å°å…¥ï¼‰</li>
                        <li>æ©Ÿç¨®æ’¤å»ï¼ˆå…¨å°æ¶ˆå¤±ï¼‰</li>
                    </ul>
                </li>
                <li><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°</strong>:
                    <ul>
                        <li>æ¯æ™‚ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚ï¼ˆfetch-availability.ymlï¼‰</li>
                        <li>æ‰‹å‹•å®Ÿè¡Œï¼ˆpython scripts/verify_units.pyï¼‰</li>
                    </ul>
                </li>
                <li><strong>æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯</strong>:
                    <ul>
                        <li>configè¨­å®šã«ã‚ã‚‹å°ç•ªå·ã§ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Œãªã„ â†’ æ¸›å°ãƒ»æ’¤å»ã®å¯èƒ½æ€§</li>
                        <li>configè¨­å®šã«ãªã„å°ç•ªå·ã§ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚ŒãŸ â†’ å¢—å°ã®å¯èƒ½æ€§</li>
                        <li>å…¨å°ã®ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Œãªã„ â†’ æ©Ÿç¨®æ’¤å» or ã‚µã‚¤ãƒˆéšœå®³</li>
                    </ul>
                </li>
                <li><strong>å¯¾å¿œ</strong>:
                    <ul>
                        <li>ã‚¢ãƒ©ãƒ¼ãƒˆç”Ÿæˆï¼ˆdata/alerts/ï¼‰</li>
                        <li>WhatsAppé€šçŸ¥ï¼ˆclawdbotçµŒç”±ï¼‰</li>
                        <li>å¤ã„ãƒ‡ãƒ¼ã‚¿ã¯å±¥æ­´ã¨ã—ã¦ä¿æŒï¼ˆå‰Šé™¤ã—ãªã„ï¼‰</li>
                        <li>æ–°ã—ã„å°ç•ªå·ã¯æ–°è¦ã¨ã—ã¦è¿½è·¡é–‹å§‹</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="notes">
            <h3>ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</h3>
            <ol>
                <li><strong>é–‹ç™º</strong>: ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆWSLï¼‰â†’ ä¸¡æ–¹ã®ãƒªãƒã‚¸ãƒˆãƒªã¸git push</li>
                <li><strong>è‡ªå‹•åŒ–</strong>: webhookã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒãƒˆãƒªã‚¬ãƒ¼</li>
                <li><strong>ãƒ‡ãƒ¼ã‚¿åé›†</strong>:
                    <ul>
                        <li>æ¯æ™‚: fetch-availability.yml (10-23æ™‚ JST)</li>
                        <li>æ—¥æ¬¡: daily_collect.yml (14:00 UTC)</li>
                        <li>é‡ã„å‡¦ç†: Circle CI (Playwright)</li>
                        <li>ãƒ­ãƒ¼ã‚«ãƒ«: 15åˆ†cron (auto_update.sh)</li>
                    </ul>
                </li>
                <li><strong>ä¿å­˜</strong>: åé›†ãƒ‡ãƒ¼ã‚¿ã‚’å„DBã¸ä¿å­˜ â†’ GitHub ã¸ã‚³ãƒŸãƒƒãƒˆ</li>
                <li><strong>å“è³ªãƒã‚§ãƒƒã‚¯</strong>: data_integrity_check.py + verify_units.py</li>
                <li><strong>ãƒ“ãƒ«ãƒ‰</strong>: deploy-static.yml â†’ recommender.py â†’ é™çš„HTML â†’ Cloudflare Pages</li>
                <li><strong>æ¤œè¨¼</strong>: validate_output.pyï¼ˆHTMLæ§‹é€ ãƒ»ãƒªãƒ³ã‚¯ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ï¼‰</li>
                <li><strong>APIãƒ‡ãƒ—ãƒ­ã‚¤</strong>: deploy.yml â†’ PythonAnywhere git pull + reload</li>
                <li><strong>å®Ÿè¡Œæ™‚</strong>:
                    <ul>
                        <li>é™çš„: Cloudflare CDNã‹ã‚‰é…ä¿¡</li>
                        <li>å‹•çš„: PythonAnywhere â†’ recommender.py â†’ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬</li>
                    </ul>
                </li>
                <li><strong>ç›£è¦–</strong>: clawdbotï¼ˆWhatsAppï¼‰ãŒé€šçŸ¥</li>
                <li><strong>çš„ä¸­æ¤œè¨¼</strong>: nightly_verify.pyï¼ˆ23:30 JSTï¼‰ã§äºˆæ¸¬ç²¾åº¦æ¸¬å®š</li>
            </ol>
        </div>

        <div class="notes">
            <h3>ğŸ’¡ ä¸»è¦ãªè¨­è¨ˆåŸå‰‡</h3>
            <ul>
                <li><strong>ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰äºˆæ¸¬</strong>: é™çš„ãƒ“ãƒ«ãƒ‰ï¼ˆé–‰åº—å¾Œï¼‰+ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼ˆå–¶æ¥­ä¸­ï¼‰ã®2ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ</li>
                <li><strong>å†—é•·æ€§</strong>: è¤‡æ•°ã®CI/CDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆGitHub Actions Ã— 2 + Circle CIï¼‰ã§å˜ä¸€éšœå®³ç‚¹ã‚’é˜²æ­¢</li>
                <li><strong>ã‚³ã‚¹ãƒˆåŠ¹ç‡</strong>: å…¨ã‚µãƒ¼ãƒ“ã‚¹ç„¡æ–™æ ã‚’æœ€å¤§é™æ´»ç”¨ï¼ˆGitHub Actions 2ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€Circle CIã€Cloudflareã€PythonAnywhereã€GASï¼‰</li>
                <li><strong>ãƒ‡ãƒ¼ã‚¿é®®åº¦</strong>: ãƒãƒ«ãƒã‚½ãƒ¼ã‚¹å–å¾—ï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« + ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ + ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ã§å¸¸ã«æœ€æ–°</li>
                <li><strong>å“è³ªä¿è¨¼</strong>: 4å±¤ã®ãƒ†ã‚¹ãƒˆï¼ˆå“è³ªãƒã‚§ãƒƒã‚¯ã€å°å¤‰å‹•æ¤œå‡ºã€HTMLæ¤œè¨¼ã€çš„ä¸­æ¤œè¨¼ï¼‰</li>
                <li><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong>: ã‚µãƒ¼ãƒ“ã‚¹é–“ã§æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’å®¹æ˜“ã«ã™ã‚‹è¨­è¨ˆ</li>
                <li><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</strong>: ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã«ç‹¬ç«‹ã—ãŸèªè¨¼æƒ…å ±ã¨SSHéµåˆ†é›¢</li>
                <li><strong>å¯è¦³æ¸¬æ€§</strong>: WhatsApp Botçµ±åˆã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚·ã‚¹ãƒ†ãƒ å¯è¦–åŒ–</li>
                <li><strong>å°å¤‰å‹•å¯¾å¿œ</strong>: è‡ªå‹•æ¤œå‡º + ã‚¢ãƒ©ãƒ¼ãƒˆ + å±¥æ­´ä¿æŒã§æŸ”è»Ÿã«å¯¾å¿œ</li>
            </ul>
        </div>

        <div class="notes future-plans">
            <h3>ğŸš€ Circle CI: ç¾çŠ¶ã¨ä»Šå¾Œã®å®Ÿè£…</h3>

            <h4>ç¾åœ¨ã®ä½¿ç”¨çŠ¶æ³</h4>
            <ul>
                <li><strong>ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ–</strong>: JavaScriptå¤šç”¨ã‚µã‚¤ãƒˆå‘ã‘PlaywrightåŸºç›¤ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°</li>
                <li><strong>é‡ã„å‡¦ç†</strong>: GitHub Actionsã®åˆ¶é™ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ/ãƒªã‚½ãƒ¼ã‚¹ï¼‰ã‚’è¶…ãˆã‚‹ã‚¿ã‚¹ã‚¯</li>
                <li><strong>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¸ãƒ§ãƒ–</strong>: æ¯æ™‚ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆ10:00-23:00 JSTï¼‰</li>
                <li><strong>æ—¥æ¬¡é›†è¨ˆ</strong>: 23:00 JSTã«1æ—¥ã®çµ‚ã‚ã‚Šã®ãƒ‡ãƒ¼ã‚¿çµ±åˆ</li>
                <li><strong>ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆå›é¿</strong>: PythonAnywhereã®åˆ¶é™ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã‚µã‚¤ãƒˆã¸ã‚¢ã‚¯ã‚»ã‚¹</li>
            </ul>

            <h4>è¨ˆç”»ä¸­ã®æ©Ÿèƒ½æ‹¡å¼µ</h4>
            <ul>
                <li><strong>é«˜åº¦ãªåˆ†æ</strong>: æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¨æ¨è«–</li>
                <li><strong>ãƒãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤</strong>: ç•°ãªã‚‹åœ°ç†çš„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã®ä¸¦åˆ—ã‚¸ãƒ§ãƒ–</li>
                <li><strong>APIçµ±åˆ</strong>: Data Provider Cã¸ã®ç›´æ¥APIã‚¢ã‚¯ã‚»ã‚¹ï¼ˆåˆ©ç”¨å¯èƒ½æ™‚ï¼‰</li>
                <li><strong>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–</strong>: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨å·®åˆ†æ›´æ–°</li>
                <li><strong>æ‹¡å¼µç›£è¦–</strong>: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã¨è‡ªå‹•å¾©æ—§æ‰‹é †</li>
                <li><strong>ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼</strong>: å“è³ªãƒã‚§ãƒƒã‚¯ã¨ç•°å¸¸æ¤œçŸ¥ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</li>
                <li><strong>ç›´æ¥CDNãƒ‡ãƒ—ãƒ­ã‚¤</strong>: Circle CI â†’ Cloudflare Pages ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</li>
            </ul>
        </div>

        <p style="text-align: center; color: #999; margin-top: 40px; font-size: 1em;">
            ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ï¼ˆå®Œå…¨ç‰ˆï¼‰| 2026
        </p>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 30,
                nodeSpacing: 100,
                rankSpacing: 100
            },
            themeVariables: {
                fontSize: '18px',
                fontFamily: 'Hiragino Sans, Yu Gothic, sans-serif'
            }
        });
    </script>
</body>
</html>
